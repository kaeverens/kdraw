!function(t){function n(t){for(var n=[t[0]],o=1;o<t.length;++o)(t[o-1][0]!=t[o][0]||t[o-1][1]!=t[o][1])&&n.push(t[o]);for(var e=[t[0]],o=1;o<n.length-1;++o){var i=!1;if(n[o-1][1]==n[o][1])n[o][1]==n[o+1][1]&&(i=!0);else if(n[o][1]!=n[o+1][1]){var u=(n[o-1][0]-n[o][0])/(n[o-1][1]-n[o][1]),r=(n[o][0]-n[o+1][0])/(n[o][1]-n[o+1][1]);u==r&&(i=!0)}i||e.push(n[o])}return e.push(n[n.length-1]),e}t.fn.kDraw=function(o){var e={pen:{colour:"#000",width:1,rotate:function(){var n=t(window).width(),o=t(window).height();return o>n}}},i=t(this);i.click(function(){function u(){w.remove(),m.remove()}function r(t,n){return l?[h-n,t]:[t,n]}function f(t,n){return l?[n,b-t]:[t,n]}function a(t,n){var o=r(t,n);g.moveTo(o[0],o[1])}function c(t,n){var o=r(t,n);g.lineTo(o[0],o[1])}function p(){g.clearRect(0,0,h,s),e=t.extend(e,o),l=e.rotate(),v=l?s:h,b=l?h:s;for(var n=0;n<k.length;++n){var i=k[n];switch(i.type){default:var u=i.p;g.beginPath(),a(u[0][0],u[0][1]);for(var r=1;r<u.length;++r)c(u[r][0],u[r][1]);g.stroke()}}}function d(t){function o(t){var n=f(t.offsetX,t.offsetY);u.push(n),g.beginPath(),a(i[0],i[1]),c(n[0],n[1]),g.stroke(),i=n}function e(){w.unbind("mousemove",o),w.unbind("mouseup",e),k.push({p:n(u)})}var i=f(t.offsetX,t.offsetY),u=[i];w.mousemove(o),w.mouseup(e)}var h=t(window).width(),s=t(window).height(),l=0,v=h,b=s,w=t('<canvas width="'+h+'" height="'+s+'" style="position:fixed;left:0;top:0;right:0;bottom:0;background:#fff;"/>').appendTo("body"),g=w[0].getContext("2d");g.strokeStyle=e.pen.colour,g.lineWidth=e.pen.width;var m=t('<div style="position:fixed;right:5px;bottom:5px;"/>').appendTo("body");t("<button>Cancel</button>").click(function(){u()}).appendTo(m),t("<button>Reset</button>").click(function(){u(),i.click()}).appendTo(m),t("<button>Clear</button>").click(function(){k=[],p()}).appendTo(m),t("<button>OK</button>").click(function(){i.find("input").val(JSON.stringify(k)),u()}).appendTo(m);var k=JSON.parse(i.find("input").val()||"[]");return p(),w.mousedown(d),!1})}}(jQuery);
