(function(e){function t(e){console.log(JSON.stringify(e));var t=[e[0]];for(var n=1;n<e.length-1;++n){var r=false;if(e[n-1][1]==e[n][1]){if(e[n][1]==e[n+1][1]){r=true}}else{if(e[n][1]!=e[n+1][1]){var i=(e[n-1][0]-e[n][0])/(e[n-1][1]-e[n][1]);var s=(e[n][0]-e[n+1][0])/(e[n][1]-e[n+1][1]);if(i==s){r=true}}}if(!r){t.push(e[n])}}t.push(e[e.length-1]);console.log(JSON.stringify(t));return t}e.fn.kDraw=function(n){var r={pen:{colour:"#000",width:1}};var i=e(this);i.click(function(){function s(){f.remove();c.remove()}function p(){l.clearRect(0,0,o,u);r=e.extend(r,n);for(var t=0;t<h.length;++t){var i=h[t];console.log(i);switch(i.type){default:var s=i.p;l.beginPath();l.moveTo(s[0][0],s[0][1]);for(var a=1;a<s.length;++a){l.lineTo(s[a][0],s[a][1])}l.stroke();break}}}function d(e){function i(e){var t=[e.offsetX,e.offsetY];r.push(t);l.beginPath();l.moveTo(n[0],n[1]);l.lineTo(t[0],t[1]);l.stroke();n=t}function s(){f.unbind("mousemove",i);f.unbind("mouseup",s);h.push({p:t(r)});console.log(JSON.stringify(h))}var n=[e.offsetX,e.offsetY];var r=[n];f.mousemove(i);f.mouseup(s)}var o=e(window).width(),u=e(window).height();var a=u>o;var f=e('<canvas width="'+o+'" height="'+u+'" style="position:fixed;left:0;top:0;right:0;bottom:0;background:#fff;"/>').appendTo("body");var l=f[0].getContext("2d");l.strokeStyle=r.pen.colour;l.lineWidth=r.pen.width;var c=e('<div style="position:fixed;right:5px;bottom:5px;"/>').appendTo("body");e("<button>Cancel</button>").click(function(){s()}).appendTo(c);e("<button>Reset</button>").click(function(){s();i.click()}).appendTo(c);e("<button>Clear</button>").click(function(){h=[];p()}).appendTo(c);e("<button>OK</button>").click(function(){i.find("input").val(JSON.stringify(h));s()}).appendTo(c);var h=JSON.parse(i.find("input").val()||"[]");p();f.mousedown(d);return false})}})(jQuery)
